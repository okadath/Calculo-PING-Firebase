var Ping=function(){};
Ping.prototype.ping=function(a,b,c){
	function d(){
		e&&clearTimeout(e);
	var a=new Date-f;
	"function"==typeof b&&b(a)
	}
	this.img=new Image,c=c||0;
	var e,f=new Date;
	this.img.onload=this.img.onerror=d,c&&(e=setTimeout(d,c)),this.img.src=a+"/?"+ +new Date};


    var chartData = {
    labels: [],
    datasets: [
        {
            label: "Ping",
            fill: true,
            lineTension: 0.4,
            backgroundColor: "rgba(100,230,100,0.04)",
            borderColor: "rgba(100,230,100,1)",
            borderCapStyle: 'butt',
            borderDash: [],
            borderDashOffset: 0.0,
            borderJoinStyle: 'bevel',
            pointBorderColor: "rgba(100,230,100,1)",
            pointBackgroundColor: "#fff",
            pointBorderWidth: 6,
            pointHoverRadius: 10,
            pointHoverBackgroundColor: "rgba(100,230,100,1)",
            pointHoverBorderColor: "rgba(220,220,220,1)",
            pointHoverBorderWidth: 1,
            pointRadius: 1,
            pointHitRadius: 10,
            data: [],

        }
    ]};

//     NA - 104.160.131.3
// EUW - 104.160.141.3
// EUNE - 104.160.142.3
// OCE - 104.160.156.1
// LAN - 104.160.136.3

var ip = {
    "na"    : "104.160.131",
    "euw"   : "104.160.141",
    "eune"  : "104.160.142",
    "oce"   : "104.160.156",
    "lan"   : "104.160.136",
};


var pingdom;
var renderCount = 0;
var host = "na";
var ctx = document.getElementById("myChart");
var max = document.getElementById("max");
var min = document.getElementById("min");
var avg = document.getElementById("avg");
var stats = document.getElementById("stats");
var rp = document.getElementById("running-ping");
var progress = document.getElementById("progress-ping");
var offset = (-25);


var myChart;

function setHost(hostV){
    host = hostV;
    console.log(ip[host]);
}
function begin(){
        
        ctx.style.display = "none";
        stats.style.display = "block";
        max.innerHTML = "-";
        min.innerHTML = "-";
        avg.innerHTML = "-";

        progress.style.display = "block";
        progress.style.width = "0%";

        document.getElementById("entry-copy").style.display = "none";

        document.getElementById("radar").style.display = "block";
        chartData.datasets[0].data = [];
        chartData.labels = [];

        var p = new Ping();

    var initTicks = 4;
    var ticks = 0;
    var plotTicks = 0;
    var maxPlotTicks = 20;
    pingdom =   setInterval(function(){

        ticks++;

        while(initTicks>1){
            initTicks --;
            return;
        }

        if(ticks%4 ==0){
            return;
            setTimeout(function(){}, 1000);
        }
        // p.ping("http://31.186.224.112", function(data) {
        p.ping("http://"+ ip[host], function(data) {

        console.log(data);
        // chartData.datasets[0].data.push(data);
        chartData.labels.push("");
        chartData.datasets[0].data.push(data + offset);
        rp.innerHTML = data + offset;


        // myChart.addData(data, "");
        progress.style.width = plotTicks/maxPlotTicks * 100 + "%";
        plotTicks ++;

        if(plotTicks> maxPlotTicks){
            end();
        }
      });

      },800);
}
function end(){
        clearInterval(pingdom);

        document.getElementById("radar").style.display = "none";
        ctx.style.display="block";

        rp.innerHTML = "-";
        progress.style.display = "none";
        max.innerHTML = Math.max.apply(null,chartData.datasets[0].data);
        min.innerHTML = Math.min.apply(null,chartData.datasets[0].data);
        avg.innerHTML = Math.floor(chartData.datasets[0].data.reduce(function(a, b) { return a + b; })/chartData.datasets[0].data.length);
        
        // alert(chartData.datasets[0].data.reduce((a, b) => a + b, 0));

if(renderCount == 0){
        myChart = new Chart(ctx, {
        type: 'line',
        data: chartData,
            options: {
        scales: {
            yAxes: [{
                 gridLines: {
                    display:false
                },   
                     ticks: {
                    beginAtZero:true,
                    suggestedMax: 250,
                }
            }]
        }
    }

    });
        renderCount++;
}else{

    myChart.config.data = chartData;
    // myChart.scales.yAxes[0].gridLines.display = true;

myChart.update();
}

}
